# üì± –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞–º –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:

1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `optimizeRoutes.js`
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - –∫—É—Ä—å–µ—Ä–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—Ä–≤–æ–º –∑–∞–∫–∞–∑–µ –≤ –æ—á–µ—Ä–µ–¥–∏
3. **–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –∂–¥–µ—Ç 20 —Å–µ–∫—É–Ω–¥
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞** - –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç (`status: "onTheWay"`), –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫—É—Ä—å–µ—Ä—É
5. **–°–ª–µ–¥—É—é—â–∏–π –∑–∞–∫–∞–∑** - –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –ø—Ä–∏–Ω—è—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–∫–∞–∑ —Ç–æ–º—É –∂–µ –∫—É—Ä—å–µ—Ä—É
6. **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è** - –µ—Å–ª–∏ –∫—É—Ä—å–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞, –æ–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫ (—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º)
```bash
node startNotificationSystem.js
```
–≠—Ç–æ—Ç —Ä–µ–∂–∏–º:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–∏:
  - –ü–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å `forAggregator: true`
  - –í—ã—Ö–æ–¥–µ –∫—É—Ä—å–µ—Ä–∞ –Ω–∞ –ª–∏–Ω–∏—é (`onTheLine: true`)
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä–æ–º
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (—Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
```bash
node testNotificationSystem.js
```
–≠—Ç–æ—Ç —Ä–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞–º –±–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### –†—É—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
```bash
node optimizeRoutes.js
```
–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –º–∞—Ä—à—Ä—É—Ç–æ–≤ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## üîß –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

### `notificationManager.js`
–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å –ª–æ–≥–∏–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
- `NotificationManager` - –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- `AutoTriggerManager` - –∫–ª–∞—Å—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### `startNotificationSystem.js`
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º.

### `testNotificationSystem.js`
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

### `optimizeRoutes.js`
–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ - —É–±—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π).

## üìä –¢—Ä–∏–≥–≥–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏:

1. **–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã** (`forAggregator: true`)
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `Order`
   - –¢—Ä–∏–≥–≥–µ—Ä: `new_order_for_aggregator`

2. **–ö—É—Ä—å–µ—Ä –≤—ã—à–µ–ª –Ω–∞ –ª–∏–Ω–∏—é** (`onTheLine: true`)
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `CourierAggregator`
   - –¢—Ä–∏–≥–≥–µ—Ä: `courier_online`

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞** (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ `orders`)
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `CourierAggregator`
   - –¢—Ä–∏–≥–≥–µ—Ä: `order_completed`

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—å–µ—Ä–æ–º

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞:

```
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –∫—É—Ä—å–µ—Ä–∞
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É:
   a. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–µ—Å–ª–∏ "onTheWay" - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)
   b. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   c. –ñ–¥–∞—Ç—å 20 —Å–µ–∫—É–Ω–¥
   d. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞
   e. –ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞
   f. –ï—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω—è—Ç - –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–∫–∞–∑—É
3. –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∑–∞–∫–∞–∑ –Ω–µ –ø—Ä–∏–Ω—è—Ç:
   a. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å status: "inactive"
   b. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å onTheLine: false
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
–í —Ñ–∞–π–ª–µ `notificationManager.js`:
```javascript
this.waitingTime = 20000; // 20 —Å–µ–∫—É–Ω–¥
```

### –£—Å–ª–æ–≤–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω –¥–ª—è:
- –ó–∞–∫–∞–∑–æ–≤ —Å `forAggregator: true`
- –ö—É—Ä—å–µ—Ä–æ–≤ —Å `onTheLine: true` –∏ `status: "active"`

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
–°–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
- üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- üë§ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—É—Ä—å–µ—Ä–æ–≤
- üì± –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–æ–≤
- ‚ùå –û—à–∏–±–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—É—Ä—å–µ—Ä–æ–≤ —Å –∑–∞–∫–∞–∑–∞–º–∏
db.courieraggregators.find({onTheLine: true, "orders.0": {$exists: true}})

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
db.orders.find({forAggregator: true, courierAggregator: null})
```

## üî¥ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
Ctrl+C
```

–°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```bash
# –ó–∞–ø—É—Å–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
node startNotificationSystem.js > notifications.log 2>&1 &

# –ò–ª–∏ —Å PM2
pm2 start startNotificationSystem.js --name "notifications"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
node testNotificationSystem.js

# –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
node optimizeRoutes.js
``` 